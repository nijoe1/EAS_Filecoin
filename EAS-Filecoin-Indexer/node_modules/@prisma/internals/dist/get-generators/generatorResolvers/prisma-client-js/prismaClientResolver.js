"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var prismaClientResolver_exports = {};
__export(prismaClientResolver_exports, {
  debug: () => debug,
  prismaClientResolver: () => prismaClientResolver
});
module.exports = __toCommonJS(prismaClientResolver_exports);
var import_debug = __toESM(require("@prisma/debug"));
var import_chalk = __toESM(require("chalk"));
var import_fs = __toESM(require("fs"));
var import_path = __toESM(require("path"));
var import_findPrismaClientDir = require("./auto-installation/findPrismaClientDir");
var import_getPackageCmd = require("./auto-installation/getPackageCmd");
var import_runPackageCmd = require("./auto-installation/runPackageCmd");
var import_checkTypeScriptVersion = require("./check-dependencies/checkTypeScriptVersion");
var import_checkYarnVersion = require("./check-dependencies/checkYarnVersion");
var import_isYarnUsed = require("./check-dependencies/isYarnUsed");
var import_resolve = require("./check-dependencies/resolve");
const debug = (0, import_debug.default)("prisma:generator");
async function prismaClientResolver(baseDir, version) {
  let prismaClientDir = await (0, import_findPrismaClientDir.findPrismaClientDir)(baseDir);
  debug("baseDir", baseDir);
  (0, import_checkYarnVersion.checkYarnVersion)();
  await (0, import_checkTypeScriptVersion.checkTypeScriptVersion)();
  if (!prismaClientDir && !process.env.PRISMA_GENERATE_SKIP_AUTOINSTALL) {
    if (!import_fs.default.existsSync(import_path.default.join(process.cwd(), "package.json")) && !import_fs.default.existsSync(import_path.default.join(process.cwd(), "../package.json"))) {
      const defaultPackageJson = `{
"name": "my-prisma-project",
"version": "1.0.0",
"description": "",
"main": "index.js",
"scripts": {
  "test": "echo \\"Error: no test specified\\" && exit 1"
},
"keywords": [],
"author": "",
"license": "ISC"
}
`;
      import_fs.default.writeFileSync(import_path.default.join(process.cwd(), "package.json"), defaultPackageJson);
      console.info(`\u2714 Created ${import_chalk.default.bold.green("./package.json")}`);
    }
    const prismaCliDir = await (0, import_resolve.resolvePkg)("prisma", { basedir: baseDir });
    if (process.platform === "win32" && (0, import_isYarnUsed.isYarnUsed)(baseDir)) {
      const hasCli = /* @__PURE__ */ __name((s) => prismaCliDir !== void 0 ? s : "", "hasCli");
      const missingCli = /* @__PURE__ */ __name((s) => prismaCliDir === void 0 ? s : "", "missingCli");
      throw new Error(
        `Could not resolve ${missingCli(`${import_chalk.default.bold("prisma")} and `)}${import_chalk.default.bold(
          "@prisma/client"
        )} in the current project. Please install ${hasCli("it")}${missingCli("them")} with ${missingCli(
          `${import_chalk.default.bold.greenBright(`${(0, import_getPackageCmd.getPackageCmd)(baseDir, "add", "prisma", "-D")}`)} and `
        )}${import_chalk.default.bold.greenBright(`${(0, import_getPackageCmd.getPackageCmd)(baseDir, "add", "@prisma/client")}`)}, and rerun ${import_chalk.default.bold(
          (0, import_getPackageCmd.getPackageCmd)(baseDir, "execute", "prisma generate")
        )} \u{1F64F}.`
      );
    }
    if (!prismaCliDir) {
      await (0, import_runPackageCmd.runPackageCmd)(baseDir, "add", `prisma@${version ?? "latest"}`, "-D");
    }
    await (0, import_runPackageCmd.runPackageCmd)(baseDir, "add", `@prisma/client@${version ?? "latest"}`);
    prismaClientDir = await (0, import_findPrismaClientDir.findPrismaClientDir)(import_path.default.join(".", baseDir));
    if (!prismaClientDir) {
      throw new Error(
        `Could not resolve @prisma/client despite the installation that we just tried.
Please try to install it by hand with ${import_chalk.default.bold.greenBright(
          `${(0, import_getPackageCmd.getPackageCmd)(baseDir, "add", "@prisma/client")}`
        )} and rerun ${import_chalk.default.bold((0, import_getPackageCmd.getPackageCmd)(baseDir, "execute", "prisma generate"))} \u{1F64F}.`
      );
    }
    console.info(
      `
\u2714 Installed the ${import_chalk.default.bold.green("@prisma/client")} and ${import_chalk.default.bold.green(
        "prisma"
      )} packages in your project`
    );
  }
  if (!prismaClientDir) {
    throw new Error(
      `Could not resolve @prisma/client.
Please try to install it with ${import_chalk.default.bold.greenBright("npm install @prisma/client")} and rerun ${import_chalk.default.bold(
        (0, import_getPackageCmd.getPackageCmd)(baseDir, "execute", "prisma generate")
      )} \u{1F64F}.`
    );
  }
  return {
    outputPath: prismaClientDir,
    generatorPath: import_path.default.resolve(prismaClientDir, "generator-build/index.js"),
    isNode: true
  };
}
__name(prismaClientResolver, "prismaClientResolver");
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  debug,
  prismaClientResolver
});
